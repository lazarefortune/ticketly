<nav class="container-box header">
    <!-- Logo -->
    <div class="flex items-center">
        <a href="{{ path('app_home') }}" {{ menu_active_aria('app_home') }} class="text-2xl font-hanken-grotesk font-medium">
            TicketLy
        </a>
    </div>

    <!-- Hamburger Menu -->
    <div class="flex items-center lg:hidden gap-2">
        {% if app.user %}
            <a href="{{ path('organizer_event_new') }}" class="btn btn-md btn-light">
                {{ icon('calendar-plus') }}
            </a>
        {% else %}
            <a href="{{ path('app_login') }}" class="btn btn-md btn-primary">
                {{ icon('user') }}
            </a>
        {% endif %}

        <button id="header-hamburger" class="text-gray-500 w-10 h-10 relative focus:outline-none bg-white">
            <span class="sr-only">Ouvrir le menu</span>
            <div class="block w-5 absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2">
                <span class="block absolute h-0.5 w-5 bg-current transform transition duration-500 ease-in-out -translate-y-1.5"></span>
                <span class="block absolute h-0.5 w-5 bg-current transform transition duration-500 ease-in-out"></span>
                <span class="block absolute h-0.5 w-5 bg-current transform transition duration-500 ease-in-out translate-y-1.5"></span>
            </div>
        </button>
    </div>

    <!-- Menu de navigation mobile (via le hamburger) -->
    <div id="header-mobile-menu" class="hidden">
        <ul class="container-box mt-10">
            {% if app.user %}
                <li>
                    <div class="flex gap-3 items-center py-6 dark:text-white border-t-0 border-x-0 border-b-slate-900/10 dark:border-b-slate-700">
                        <img src="{{ app.user|avatar }}" alt="{{ app.user.fullname }}" class="w-10 h-10 rounded-full object-cover">
                        <span class="overflow-hidden text-slate-900 dark:text-white">{{ app.user.fullname }}</span>
                    </div>
                </li>
                {% if is_granted('ROLE_ADMIN') %}
                    <li>
                        <a href="{{ path('admin_home') }}" class="flex items-center gap-3 py-6 dark:text-white border-t-0 border-x-0 border-b-slate-900/10 dark:border-b-slate-700">
                            {{ icon('shield', 20) }} <span>Admin</span>
                        </a>
                    </li>
                    <div class="border-b border-slate-200 dark:border-slate-700 my-1"></div>
                {% endif %}
                {% if app.user.stripeAccountCompleted or is_granted('ROLE_ADMIN') %}
                    <li>
                        <a href="{{ path('organizer_home') }}" class="flex items-center gap-3 py-6 dark:text-white border-t-0 border-x-0 border-b-slate-900/10 dark:border-b-slate-700">
                            {{ icon('monitor', 20) }} <span>Mes événements</span>
                        </a>
                    </li>
                {% endif %}
                <li>
                    <a href="{{ path('app_my_reservation_index') }}" class="flex items-center gap-3 py-6 dark:text-white border-t-0 border-x-0 border-b-0">
                        {{ icon('calendar-days', 20) }} Mes réservations
                    </a>
                </li>
                <div class="border-b border-slate-200 dark:border-slate-700 my-1"></div>
                <li>
                    <a href="{{ path('app_account_profile') }}" class="flex gap-3 items-center py-6 dark:text-white border-t-0 border-x-0 border-b-slate-900/10 dark:border-b-slate-700">
                        {{ icon('user', 20) }} <span>Mon compte</span>
                    </a>
                </li>
            {% else %}
                <li class="mb-3">
                    <a href="{{ path('app_register') }}" class="btn btn-md btn-primary w-full">
                        {{ icon('calendar-plus', 20) }} Créer un événement
                    </a>
                </li>
                <li>
                    <a href="{{ path('app_login') }}" class="btn btn-md btn-light w-full">
                        {{ icon('user', 20) }} Se connecter
                    </a>
                </li>
            {% endif %}
            {% if app.user and is_granted('ROLE_PREVIOUS_ADMIN') %}
                <li>
                    <a href="{{ path('app_home', {'_switch_user': '_exit'}) }}" class="flex items-center gap-3 py-6 dark:text-white border-t-0 border-x-0 border-b-slate-900/10 dark:border-b-slate-700">
                        {{ icon('monitor-x', 20) }} Arrêter le switch
                    </a>
                </li>
            {% endif %}
            {% if app.user %}
                <li>
                    <a href="{{ path('app_logout') }}" class="btn btn-md btn-light-danger2 w-full mt-10">
                        {{ icon('log-out', 20) }} Déconnexion
                    </a>
                </li>
            {% endif %}
        </ul>
    </div>

    <!-- Menu de navigation desktop -->
    <ul class="header-side hidden lg:flex">
        <li class="flex items-center gap-1 relative">
            {% if app.user %}
                <a href="{% if not app.user.stripeAccountId %}{{ path('app_account_stripe_connect') }}{% else %}{{ path('organizer_event_new') }}{% endif %}" class="header__menu__link mr-4">
                    {{ icon('calendar-plus') }} <span class="underline-hover-effect">Créer un événement</span>
                </a>
                <button class="dropdown-user-button flex items-center p-2 md:px-4 md:py-2 gap-2 min-w-32 border bg-white hover:bg-primary-100 hover:text-primary-900 dark:text-white dark:bg-dark-soft dark:hover:bg-dark-soft-2 dark:border-dark-soft rounded-md" aria-controls="dropdown-user">
                    <img class="h-8 w-8 rounded-full object-cover" src="{{ app.user|avatar }}" alt="{{ app.user.fullname }} avatar">
                    <div class="hidden md:flex flex-col text-start max-w-44 overflow-hidden">
                        <span class="text-sm">{{ app.user.fullname }}</span>
                    </div>
                </button>
                <div id="dropdown-user" class="absolute right-0 top-[68px] w-64 bg-white dark:bg-dark-soft border border-slate-200 dark:border-slate-700 shadow rounded-md opacity-0 scale-95 transition-opacity duration-100 ease-out invisible pointer-events-none p-2">
                    {% if is_granted('ROLE_ADMIN') %}
                        <a href="{{ path('admin_home') }}" class="flex items-center justify-start gap-2 rounded-md p-2 text-sm hover:bg-primary-100 dark:hover:bg-dark-soft-2 dark:text-white">
                            {{ icon('shield') }} <span>Admin</span>
                        </a>
                        <div class="border-b border-slate-200 dark:border-slate-700 my-1"></div>
                    {% endif %}
                    {% if app.user.stripeAccountCompleted or is_granted('ROLE_ADMIN') %}
                        <a href="{{ path('organizer_home') }}" class="flex items-center justify-start gap-2 rounded-md p-2 text-sm hover:bg-primary-100 dark:hover:bg-dark-soft-2 dark:text-white">
                            {{ icon('monitor') }} <span>Mes événements</span>
                        </a>
                    {% endif %}
                    <a href="{{ path('app_my_reservation_index') }}" class="flex items-center justify-start gap-2 rounded-md p-2 text-sm hover:bg-primary-100 dark:hover:bg-dark-soft-2 dark:text-white">
                        {{ icon('calendar-days') }} <span>Mes réservations</span>
                    </a>
                    <div class="border-b border-slate-200 dark:border-slate-700 my-1"></div>
                    <a href="{{ path('app_account_profile') }}" class="flex items-center justify-start gap-2 rounded-md p-2 text-sm hover:bg-primary-100 dark:hover:bg-dark-soft-2 dark:text-white {{ menu_active('app_account_profile') }}">
                        {{ icon('user') }} <span>Mon compte</span>
                    </a>
                    {% if app.user and is_granted('ROLE_PREVIOUS_ADMIN') %}
                        <a href="{{ path('app_home', {'_switch_user': '_exit'}) }}" class="flex items-center justify-start gap-2 rounded-md p-2 text-sm hover:bg-primary-100 dark:hover:bg-dark-soft-2 dark:text-white">
                            {{ icon('monitor-x') }} <span>Revenir à mon compte</span>
                        </a>
                    {% endif %}
                    <a href="{{ path('app_logout') }}" class="flex items-center justify-start gap-2 rounded-md p-2 text-sm hover:bg-primary-100 dark:hover:bg-dark-soft-2 dark:text-white">
                        {{ icon('log-out') }} <span>Déconnexion</span>
                    </a>
                </div>
            {% else %}
                <a href="{{ path('app_register') }}" class="btn btn-sm btn-primary">
                    {{ icon('calendar-plus') }} <span>Créer un événement</span>
                </a>
                <span class="text-muted">·</span>
                <a href="{{ path('app_login') }}" class="btn btn-sm btn-light">
                    Se connecter
                </a>
            {% endif %}
        </li>
    </ul>
</nav>
